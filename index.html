<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cassette Recording Helper</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <script src="https://cdn.jsdelivr.net/npm/howler@2.2.4/dist/howler.core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/wavesurfer.js@7.7.14/dist/wavesurfer.min.js"></script>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <main class="app">
      <header>
        <div class="header-top">
          <h1 data-i18n="appTitle">Cassette Recording Helper</h1>
          <div class="header-actions">
            <label class="theme-toggle" aria-label="Toggle dark mode" data-i18n-aria="toggleTheme">
              <input type="checkbox" id="themeSwitch">
              <span class="slider" aria-hidden="true">
                <span class="thumb"></span>
              </span>
              <span class="sr-only" data-i18n="toggleTheme">Toggle dark mode</span>
            </label>
            <div class="lang-menu">
              <button id="langButton" class="lang-button" type="button" aria-haspopup="true" aria-expanded="false" aria-label="Language">
                <img class="lang-icon" src="lang-icon.svg" alt="">
              </button>
              <div id="langMenu" class="lang-dropdown" hidden>
                <button type="button" data-lang="zh-CN">简体中文</button>
                <button type="button" data-lang="en">English</button>
                <button type="button" data-lang="ja">日本語</button>
              </div>
            </div>
          </div>
        </div>
        <p data-i18n="tagline">Import audio, reorder, set gaps, and preview directly.</p>
      </header>

      <section class="panel">
        <label class="file-drop">
          <span data-i18n="importLabel">Click or drop to add music files</span>
          <input
            id="audioInput"
            type="file"
            accept=".mp3,.m4a,.aac,.flac,.wav,.ogg,.opus,.mp4,.mkv,.mov,.avi,.webm,audio/*,video/*"
            multiple
          >
        </label>
        <small data-i18n="importNote">Some uncommon formats may not be supported</small>
      </section>

      <section class="panel gap-panel">
        <label for="gapInput" data-i18n="gapLabel">Silence between songs (sec)</label>
        <input id="gapInput" type="number" min="0" step="1" value="3.0">
        <label for="leadInput" data-i18n="leadLabel">Lead-in silence (sec)</label>
        <input id="leadInput" type="number" min="0" step="1" value="3.0">
        <div class="total-time">
          <span data-i18n="totalDurationLabel">Total time:</span>
          <strong id="totalDuration">00:00</strong>
        </div>
      </section>

      <section class="panel playlist-panel">
        <div class="panel-header">
          <h2 data-i18n="playlistTitle">Playlist</h2>
          <div class="playlist-actions">
            <label class="lock-toggle level-toggle" aria-label="Toggle auto level check" data-i18n-aria="runLevelCheck">
              <input type="checkbox" id="levelCheckToggle">
              <span class="slider"></span>
              <span class="lock-label" data-i18n="runLevelCheck">执行电平检查</span>
            </label>
            <label class="lock-toggle" aria-label="Toggle drag lock" data-i18n-aria="toggleLockDrag">
              <input type="checkbox" id="lockReorder">
              <span class="slider"></span>
              <span class="lock-label" data-i18n="lockDrag">Lock drag</span>
            </label>
            <button id="clearList" type="button" data-i18n="clearList">Clear list</button>
          </div>
        </div>
        <ul id="playlist" class="playlist" aria-live="polite"></ul>
        <p class="hint" data-i18n="playlistHint">Drag to reorder; click any track to load in the player.</p>
      </section>

      <section class="panel player-panel">
        <div class="panel-header">
          <h2 data-i18n="playerTitle">Player</h2>
          <div class="player-actions">
            <button id="playAll" type="button" data-i18n="playFromStart">Play from start</button>
            <button id="togglePlay" type="button" data-i18n="playPauseButton">Play / Pause</button>
            <button id="stopPlay" type="button" data-i18n="stopButton">Stop</button>
          </div>
        </div>
        <p id="nowPlaying" data-i18n="nowPlaying.idle">Nothing selected yet</p>
        <div class="progress-row">
          <span class="progress-label" data-i18n="progressOverall">Overall</span>
          <div class="progress">
            <div id="globalProgressBar" class="progress-bar"></div>
          </div>
          <span id="globalProgressText" class="progress-text">00:00 / 00:00</span>
        </div>
        <div id="gapProgressRow" class="progress-row gap-row" hidden>
          <span class="progress-label" data-i18n="progressGap">Gap</span>
          <div class="progress">
            <div id="gapProgressBar" class="progress-bar gap"></div>
          </div>
          <span id="gapProgressText" class="progress-text">0s</span>
        </div>
      </section>

      <section class="panel peak-panel">
        <div class="panel-header">
          <h2 data-i18n="levelCheckTitle">Level check</h2>
          <div class="peak-actions">
            <button id="analyzePeak" class="btn-peak-reset" type="button" data-i18n="analyzePeak">Analyze peak</button>
            <button id="playPeakFromStart" class="btn-peak-start" type="button" data-i18n="playFromStart" disabled>Play from start</button>
            <button id="togglePeakPlay" class="btn-peak-toggle" type="button" data-i18n="playPauseButton" disabled>Play / Pause</button>
          </div>
        </div>
        <p id="peakStatus" class="peak-status" data-i18n="peakIdle">Select a track and analyze to find the loudest spot.</p>
        <div id="peakWaveform" class="peak-waveform" aria-label="Waveform visualization"></div>
        <p class="hint" data-i18n="levelNote">电平检查用于没有自动电平调节的老式卡座或简易录音机，可选用。</p>
      </section>
    </main>

    <template id="playlistItemTemplate">
      <li class="track" draggable="false">
        <div class="track-row">
          <div class="track-meta">
            <span class="track-number"></span>
            <span class="track-title"></span>
            <span class="track-format"></span>
            <span class="track-duration"></span>
          </div>
          <span class="drag-handle" aria-label="Drag to reorder" title="Drag to reorder"></span>
          <button class="track-delete" type="button" aria-label="Delete this track" data-i18n="delete" data-i18n-aria="deleteThis">Delete</button>
        </div>
      </li>
    </template>

    <script src="js/utils.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/peak-visualizer.js"></script>
    <script src="js/level-utils.js"></script>
    <script src="script.js"></script>
  </body>
</html>
